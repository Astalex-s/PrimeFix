services:
  nginx:
    image: nginx:alpine
    container_name: nginx
    depends_on:
      - postgres
      - pgadmin
      # - backend  # будет активирован при реализации бэкенда
    ports:
      - "80:80"
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
    networks:
      - internal

  postgres:
    image: postgres:16-alpine
    container_name: postgres
    environment:
      POSTGRES_DB: app_db
      POSTGRES_USER: app_user
      POSTGRES_PASSWORD: change_me
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - internal

  pgadmin:
    image: dpage/pgadmin4:8
    container_name: pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: change_me
      PGADMIN_LISTEN_PORT: 80
    ports:
      - "5050:80"
    depends_on:
      - postgres
    networks:
      - internal

  registry:
    image: registry:2
    container_name: registry
    ports:
      - "5000:5000"
    environment:
      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /var/lib/registry
      REGISTRY_AUTH: htpasswd
      REGISTRY_AUTH_HTPASSWD_REALM: "Registry Realm"
      REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd
    volumes:
      - registry_data:/var/lib/registry
      - ./registry/auth:/auth
    networks:
      - internal

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    command: --cleanup --interval 300
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - internal

  # backend:
  #   image: backend-image:latest
  #   container_name: backend
  #   restart: always
  #   environment:
  #     # TODO: добавить переменные окружения для подключения к PostgreSQL (настроить при реализации бэкенда)
  #     # DB_HOST=postgres
  #     # DB_PORT=5432
  #     # DB_NAME=app_db
  #     # DB_USER=app_user
  #     # DB_PASSWORD=change_me
  #   depends_on:
  #     - postgres
  #   networks:
  #     - internal

volumes:
  postgres_data:
  registry_data:

networks:
  internal:
    driver: bridge
    internal: true

